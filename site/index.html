<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Informed Consent – Trials Explorer</title>
<link rel="stylesheet" href="assets/styles.css"/>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
</head><body>
<div class="container">
  <h1>Informed Consent – Trials Explorer</h1>
  <input id="q" type="search" placeholder="Search by NCT, title, author, year…"/>
  <div class="small" style="margin:6px 0 12px 0;">Tip: click a result to open per-study page (with PDF preview).</div>
  <div id="results"></div>
</div>
<script>
const esc=(s)=> (s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;")
const card=(r)=> `
  <div class="card">
    <div><a href="studies/${r.nct}.html"><strong>${esc(r.nct)}</strong></a> – ${esc(r.title) || "(untitled)"}</div>
    <div class="meta">
      ${r.year?`<span class="badge">${esc(r.year)}</span>`:""}
      ${(r.authors && r.authors.length)?`<span class="badge">${esc(r.authors[0])}</span>`:""}
      ${r.doc_count?`<span class="badge">${r.doc_count} document(s)</span>`:"<span class='badge'>0 document(s)</span>"}
      ${r.registry_url?`<a class="badge" href="${r.registry_url}" target="_blank" rel="noopener">Registry</a>`:""}
    </div>
  </div>`;

let DATA=[];
async function init(){
  DATA = await (await fetch('assets/studies.json')).json();
  render(DATA);
  const fuse = new Fuse(DATA, {
    keys:['nct','title','authors','year'],
    threshold:0.35,
    ignoreLocation:true
  });
  document.getElementById('q').addEventListener('input', (e)=>{
    const v=e.target.value.trim();
    if(!v) return render(DATA);
    render(fuse.search(v).map(x=>x.item));
  });
}
function render(items){
  const el=document.getElementById('results');
  el.innerHTML = items.map(card).join('') || '<div class="meta">No matches.</div>';
}
init();
</script>
</body></html>
